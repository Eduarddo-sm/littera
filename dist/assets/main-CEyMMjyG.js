import{s as p,a as c}from"./popup-BbttVVEm.js";/* empty css              */import{v as F,a as W}from"./auth-CgpHnlSf.js";async function _(e){try{const{data:{user:n}}=await p.auth.getUser();let t=p.from("anuncios").select("id, titulo, autora, paginas, editora, sobre, imagens, status, user_id, generos").or("status.eq.EM ABERTO,status.is.null,status.eq.FECHADO");if(n&&(t=t.neq("user_id",n.id)),e&&e.trim()!==""){const s=e.trim();t=t.ilike("titulo",`%${s}%`)}const{data:o,error:a}=await t;return a?(console.error("Erro ao buscar livros:",a),[]):o||[]}catch(n){return console.error("Erro inesperado ao buscar livros:",n),[]}}function X(e){const n=document.createElement("div");n.className="card",n.style.position="relative";const t=document.createElement("img");t.className="card-thumb",t.src=e.imagens&&e.imagens.length>0?e.imagens[0]:"",t.alt=e.titulo;const o=document.createElement("h3");o.textContent=e.titulo;const a=document.createElement("div");a.className="card-meta";const s=[];e.status&&s.push(e.status),e.status==="FECHADO"&&(a.style.color="#bb0000ff",a.style.background="#ffa9a9d5"),a.textContent=s.join(" ");const i=document.createElement("div");if(i.className="card-generos",e.generos&&e.generos.length>0)e.generos.slice(0,3).forEach(d=>{const l=document.createElement("span");l.className="genero-tag",l.textContent=d,i.appendChild(l)});else{const d=document.createElement("span");d.className="genero-tag",d.textContent="Sem gênero",i.appendChild(d)}const r=document.createElement("button");return r.className="more",r.textContent="Ver mais",r.addEventListener("click",()=>{window.location.href=`/pages/livro/livroPagina.html?id=${e.id}`}),n.appendChild(t),n.appendChild(a),n.appendChild(o),n.appendChild(i),n.appendChild(r),n}function J(e,n){e.innerHTML="";const t=document.createElement("div");t.className="tooltip-box",t.textContent=n?`Nenhum resultado encontrado para "${n}".`:"Nenhum anúncio encontrado.",e.appendChild(t)}async function k(e){const n=await _(e),t=document.getElementById("cards-grid");if(t){if(t.innerHTML="",!n||Array.isArray(n)&&n.length===0){J(t,e);return}n.forEach(o=>{t.appendChild(X(o))})}}function K(){const e=document.getElementById("popup-input"),n=document.querySelector(".top-nav .btn");if(e){e.addEventListener("keydown",a=>{if(a.key==="Enter"){const s=e.value.trim();k(s)}});const o=((a,s=300)=>{let i;return(...r)=>{i&&window.clearTimeout(i),i=window.setTimeout(()=>a(...r),s)}})(()=>{const a=e.value.trim();k(a===""?void 0:a)},300);e.addEventListener("input",o)}n&&n.addEventListener("click",t=>{if(t.preventDefault(),e){e.focus();const o=e.value.trim();o!==""&&setTimeout(()=>k(o),100)}})}document.addEventListener("DOMContentLoaded",()=>{k(),K()});const f=document.getElementById("signout-btn"),m=document.getElementById("userArea"),y=document.getElementById("areaDoCliente"),I=document.getElementById("add-book-btn"),Q=document.getElementsByTagName("body")[0];async function Y(){const{data:e,error:n}=await p.auth.getUser();try{if(await F()){const o=e.user.id;f&&(f.style.display="block"),m&&(m.style.display="block"),y&&(y.innerHTML=`
                <p><a href="/pages/meusAnuncios/meusAnuncios.html">Meus Anuncios</a></p>
                <p><a href="/pages/minhasPropostas/minhasPropostas.html">Minhas Propostas</a></p>
                <p><a href="/pages/loja/perfil.html?id=${o}">Sua Loja</a></p>
            `)}else f&&(f.style.display="none"),y&&(y.style.display="none",y.innerHTML=""),I&&(I.style.display="none"),m&&(m.innerText="Faça login",m.href="pages/login/login.html")}catch(t){console.error("Erro ao checar autenticação:",t)}}f&&f.addEventListener("click",async e=>{e.preventDefault();try{const{error:n}=await p.auth.signOut(),t=await F();console.log("estado auth:",t),t||(f&&(f.style.display="none"),y&&(y.style.display="none"),I&&(I.style.display="none")),m&&(m.innerText="Faça login",m.href="/pages/login/login.html")}catch(n){console.error("Erro no fluxo de signOut:",n),c("Erro ao sair. Veja o console para detalhes.",3e3,0)}});W();Y();Q.style.display="block";const C=document.getElementById("menu-toggle"),x=document.getElementById("sidebar"),T=document.getElementById("sidebar-overlay"),g=document.getElementById("sidebar-close");function Z(){x.classList.add("active"),T.classList.add("active"),C.classList.add("active"),document.body.style.overflow="hidden",window.innerWidth<=768&&g&&(g.style.display="block")}function L(){x.classList.remove("active"),T.classList.remove("active"),C.classList.remove("active"),document.body.style.overflow="",g&&(g.style.display="none")}C&&C.addEventListener("click",()=>{x.classList.contains("active")?L():Z()});T&&T.addEventListener("click",L);g&&g.addEventListener("click",L);const ee=x.querySelectorAll("a");ee.forEach(e=>{e.addEventListener("click",()=>{window.innerWidth<=768&&L()})});window.addEventListener("resize",()=>{window.innerWidth>768&&(L(),g&&(g.style.display="none"))});document.addEventListener("DOMContentLoaded",()=>{document.body.style.overflowX="hidden"});const A=document.getElementById("search-icon"),M=document.getElementById("close-search"),N=document.getElementById("popup-search-container"),h=document.getElementById("popup-input"),j=document.getElementById("logo-header");let v=!1;function te(){v||(v=!0,N.classList.add("active"),j.classList.add("hidden"),M.classList.add("active"),A.style.display="none",setTimeout(()=>{h.focus()},300))}function D(){v&&(v=!1,N.classList.remove("active"),j.classList.remove("hidden"),M.classList.remove("active"),A.style.display="block")}A&&A.addEventListener("click",e=>{e.preventDefault(),te()});M&&M.addEventListener("click",()=>{D()});document.addEventListener("keydown",e=>{e.key==="Escape"&&v&&D()});h&&(h.addEventListener("keydown",e=>{e.key==="Enter"&&v&&(console.log("Pesquisando:",h.value),setTimeout(()=>{D()},500))}),h.addEventListener("blur",()=>{setTimeout(()=>{v&&document.activeElement!==h&&D()},200)}));N&&N.addEventListener("click",e=>{e.stopPropagation()});const H=document.getElementById("form-cadastrar-livro");let b=[],u=[];function B(){const e=document.getElementById("image-preview");e&&(e.innerHTML="",b.forEach((n,t)=>{const o=new FileReader;o.onload=a=>{const s=document.createElement("div");s.className="image-preview-item";const i=document.createElement("img");i.src=a.target?.result;const r=document.createElement("button");r.className="image-preview-remove",r.innerHTML="×",r.type="button",r.style=`
            width: 30%;
            background: #737373;
            border: none;
            color: #ffffff;
      `,r.onclick=()=>{b.splice(t,1),B(),ne()},s.appendChild(i),s.appendChild(r),e.appendChild(s)},o.readAsDataURL(n)}))}function U(){const e=document.getElementById("generos-tags");e&&(e.innerHTML="",u.forEach((n,t)=>{const o=document.createElement("div");o.className="genero-tag";const a=document.createElement("span");a.textContent=n;const s=document.createElement("button");s.className="genero-tag-remove",s.innerHTML="×",s.type="button",s.onclick=()=>{u.splice(t,1),U()},o.appendChild(a),o.appendChild(s),e.appendChild(o)}))}function ne(){const e=document.getElementById("imagem");if(!e)return;const n=new DataTransfer;b.forEach(t=>n.items.add(t)),e.files=n.files}async function oe(e){const n=[];for(let t=0;t<Math.min(e.length,5);t++){const o=e[t],a=o.name.split(".").pop(),s=`public/${Date.now()}-${Math.random().toString(36).substring(2,8)}.${a}`,{data:i,error:r}=await p.storage.from("livros").upload(s,o);if(r)throw console.error("Erro ao fazer upload:",r),r;if(!i)throw console.error("Upload retornou sem dados"),new Error("Falha no upload da imagem");const{data:d}=p.storage.from("livros").getPublicUrl(s);if(d?.publicUrl)n.push(d.publicUrl);else throw console.error("Não foi possível obter URL pública"),new Error("Falha ao obter URL da imagem")}return n}if(H){const e=document.getElementById("imagem"),n=document.getElementById("genero-input");n&&n.addEventListener("keydown",t=>{if(t.key==="Enter"){t.preventDefault();const o=n.value.trim();if(o==="")return;if(u.length>=10){c("Você pode adicionar no máximo 10 gêneros.",3e3,0);return}if(u.includes(o)){c("Este gênero já foi adicionado.",3e3,0);return}u.push(o),U(),n.value=""}}),e&&e.addEventListener("change",t=>{const o=t.target.files;if(o){if(o.length>5){c("Você pode selecionar no máximo 5 imagens.",3e3,0),e.value="",b=[],B();return}b=Array.from(o),B()}}),H.addEventListener("submit",async t=>{t.preventDefault();const o=document.getElementById("titulo").value,a=document.getElementById("autora").value,s=parseInt(document.getElementById("paginas").value,10),i=document.getElementById("editora").value,r=document.getElementById("sobre").value,l=document.getElementById("imagem").files;if(!l||l.length===0){c("Selecione pelo menos uma imagem.",3e3,0);return}if(l.length>5){c("Você pode enviar no máximo 5 imagens.",3e3,0);return}if(u.length===0){c("Adicione pelo menos um gênero literário.",3e3,0);return}try{const{data:w,error:O}=await p.auth.getUser();if(O||!w?.user){c("Usuário não autenticado.",3e3,0),console.error("Erro de autenticação:",O);return}const V=w.user.id;let P=[];try{P=await oe(l)}catch(G){c("Erro ao fazer upload das imagens. Tente novamente.",3e3,0),console.error("Erro upload imagens:",G);return}const{data:z,error:$}=await p.from("anuncios").insert([{user_id:V,titulo:o,autora:a,paginas:s,editora:i,sobre:r,imagens:P,generos:u}]);if($){c("Erro ao inserir no banco.",3e3,0),console.error("Erro insert:",$);return}console.log("Insert data:",z),c("Livro cadastrado com sucesso!",3e3,1),H.reset(),b=[],u=[],B(),U();const q=document.getElementById("add-book-modal");q&&(q.classList.remove("active"),document.body.style.overflow=""),window.location.reload()}catch(w){c("Erro inesperado ao cadastrar livro.",3e3,0),console.error("Erro inesperado:",w)}})}const S=document.getElementById("add-book-btn"),E=document.getElementById("add-book-modal"),R=document.getElementById("close-add-book-modal");S&&S.addEventListener("click",async()=>{await F()?(E.classList.add("active"),document.body.style.overflow="hidden"):S.style.display="none"});R&&R.addEventListener("click",()=>{E.classList.remove("active"),document.body.style.overflow=""});E?.addEventListener("click",e=>{e.target===E&&(E.classList.remove("active"),document.body.style.overflow="")});document.addEventListener("keydown",e=>{e.key==="Escape"&&E?.classList.contains("active")&&(E.classList.remove("active"),document.body.style.overflow="")});document.getElementById("imagem");document.getElementById("image-preview");
