import{s as f,c as P}from"./supabase-DontodQT.js";import{a as U}from"./auth-DHS0uDGa.js";const g=document.getElementById("user-name"),y=document.getElementById("user-fullname"),E=document.getElementById("user-email"),v=document.getElementById("user-phone"),p=document.getElementById("user-bio");async function B(){const{data:e,error:t}=await f.auth.getUser(),r=e?.user;if(t){console.error(t);return}if(!r){U();return}const{data:a,error:l}=await f.from("profiles").select("*").eq("id",r.id).single();if(l){console.error(l);return}g&&(g.innerText=a.username||""),y&&(y.innerText=a.name||""),E&&(E.innerText=a.email||""),v&&(v.innerText=a.phone||""),p&&(p.innerText=a.bio||"")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{B().catch(e=>console.error("Erro ao carregar dados do usuário:",e))}):B().catch(e=>console.error("Erro ao carregar dados do usuário:",e));const x=void 0,k=void 0,o=P(x,k);let n=null,i=null;const m=document.getElementById("view-mode"),c=document.getElementById("edit-mode"),C=document.getElementById("edit-profile-btn"),_=document.getElementById("cancel-edit-btn"),I=document.getElementById("edit-profile-form"),d=document.getElementById("edit-avatar"),b=document.getElementById("avatar-preview");async function h(){try{const{data:{user:e}}=await o.auth.getUser();if(!e){window.location.href="/src/pages/login/login.html";return}const{data:t,error:r}=await o.from("profiles").select("*").eq("id",e.id).single();if(r)throw r;n=t,w(t)}catch(e){console.error("Erro ao carregar perfil:",e),alert("Erro ao carregar perfil do usuário")}}function w(e){const t=document.getElementById("user-name"),r=document.getElementById("user-fullname"),a=document.getElementById("user-email"),l=document.getElementById("user-phone");document.getElementById("user-bio");const u=document.getElementById("user-avatar");if(t.textContent=e.username||"Username",r.textContent=e.name||"Nome não informado",a.textContent=e.email||"Email não informado",l.textContent=e.phone||"Telefone não informado",e.avatar_url){const s=o.storage.from("userProfiles").getPublicUrl(e.avatar_url).data.publicUrl;u.style.backgroundImage=`url(${s})`}if(document.getElementById("edit-username").value=e.username||"",document.getElementById("edit-fullname").value=e.name||"",document.getElementById("edit-email").value=e.email||"",document.getElementById("edit-phone").value=e.phone||"",e.avatar_url){const s=o.storage.from("userProfiles").getPublicUrl(e.avatar_url).data.publicUrl;b.style.backgroundImage=`url(${s})`}}d.addEventListener("change",e=>{const t=e.target.files?.[0];if(t){if(!["image/jpeg","image/jpg","image/png"].includes(t.type)){alert("Por favor, selecione uma imagem JPG ou PNG"),d.value="";return}if(t.size>5*1024*1024){alert("A imagem deve ter no máximo 5MB"),d.value="";return}i=t;const r=new FileReader;r.onload=a=>{b.style.backgroundImage=`url(${a.target?.result})`},r.readAsDataURL(t)}});C.addEventListener("click",()=>{m.style.display="none",c.style.display="block"});_.addEventListener("click",()=>{c.style.display="none",m.style.display="block",i=null,n&&w(n)});I.addEventListener("submit",async e=>{if(e.preventDefault(),!n)return;const t=I.querySelector('button[type="submit"]');t.disabled=!0,t.textContent="Salvando...";try{let r=n.avatar_url;if(i){n.avatar_url&&await o.storage.from("userProfiles").remove([n.avatar_url]);const l=i.name.split(".").pop(),u=`public/${n.id}-${Date.now()}.${l}`,{error:s}=await o.storage.from("userProfiles").upload(u,i);if(s)throw s;r=u}const{error:a}=await o.from("profiles").update({username:document.getElementById("edit-username").value,name:document.getElementById("edit-fullname").value,phone:document.getElementById("edit-phone").value,avatar_url:r}).eq("id",n.id);if(a)throw a;alert("Perfil atualizado com sucesso!"),await h(),c.style.display="none",m.style.display="block",i=null}catch(r){console.error("Erro ao salvar perfil:",r),alert("Erro ao salvar alterações. Tente novamente.")}finally{t.disabled=!1,t.textContent="Salvar Alterações"}});h();
