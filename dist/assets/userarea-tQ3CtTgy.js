import{s as a}from"./supabase-C7rZz57M.js";import{a as h}from"./guard-SrXEI54j.js";const i=document.getElementById("user-name"),d=document.getElementById("user-fullname"),u=document.getElementById("user-email"),l=document.getElementById("user-phone"),m=document.getElementById("user-bio"),p=document.getElementById("delete-account");async function f(){const{data:r,error:s}=await a.auth.getUser(),n=r?.user;if(s){console.error(s);return}if(!n){h();return}const{data:e,error:t}=await a.from("profiles").select("*").eq("id",n.id).single();if(t){console.error(t);return}i&&(i.innerText=e.username||""),d&&(d.innerText=e.name||""),u&&(u.innerText=e.email||""),l&&(l.innerText=e.phone||""),m&&(m.innerText=e.bio||"")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{f().catch(r=>console.error("Erro ao carregar dados do usuário:",r))}):f().catch(r=>console.error("Erro ao carregar dados do usuário:",r));p?.addEventListener("click",async r=>{if(!confirm("Tem certeza que deseja apagar sua conta? Esta ação é irreversível."))return;const{data:{user:n}}=await a.auth.getUser();if(!n){alert("Usuário não autenticado.");return}const{data:e,error:t}=await a.auth.getSession(),c=e?.session?.access_token;if(t||!c){console.error("Erro ao obter token de sessão:",t),alert("Não foi possível obter credenciais para deletar a conta. Faça login novamente e tente novamente.");return}try{console.log("DEBUG_DELETE_ACCOUNT_TOKEN:",c)}catch{}try{const o=await fetch("/api/delete-account",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({})});if(!o.ok){const E=await o.json().catch(()=>null);console.error("Erro ao deletar conta (server):",o.status,E),alert("Erro ao deletar conta. Veja o console para mais detalhes.");return}await a.auth.signOut(),window.location.href="../index.html"}catch(o){console.error("Erro na requisição de delete-account:",o),alert("Erro ao conectar com o servidor para deletar conta. Veja o console para detalhes.")}});
