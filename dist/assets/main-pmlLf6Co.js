import{s as f,a as c}from"./popup-B9BBiTrj.js";/* empty css              */import{a as j}from"./auth-MsIIcA0s.js";import"./login-BpsihPwV.js";async function z(e){try{const{data:{user:t}}=await f.auth.getUser();let n=f.from("anuncios").select("id, titulo, autora, paginas, editora, sobre, imagens, status, user_id").or("status.eq.EM ABERTO,status.is.null,status.eq.FECHADO");if(t&&(n=n.neq("user_id",t.id)),e&&e.trim()!==""){const r=e.trim();n=n.ilike("titulo",`%${r}%`)}const{data:o,error:a}=await n;return a?(console.error("Erro ao buscar livros:",a),[]):o||[]}catch(t){return console.error("Erro inesperado ao buscar livros:",t),[]}}function G(e){const t=document.createElement("div");t.className="card",t.style.position="relative";const n=document.createElement("img");n.className="card-thumb",n.src=e.imagens&&e.imagens.length>0?e.imagens[0]:"",n.alt=e.titulo;const o=document.createElement("h3");o.textContent=e.titulo;const a=document.createElement("div");a.className="card-meta";const r=[];e.status&&r.push(e.status),e.status==="FECHADO"&&(a.style.color="#bb0000ff",a.style.background="#ffa9a9d5"),a.textContent=r.join(" ");const i=document.createElement("p");i.textContent=e.sobre;const s=50;i.textContent.length>s&&(i.textContent=i.textContent.slice(0,s)+"...");const d=document.createElement("button");return d.className="more",d.textContent="Ver mais",d.addEventListener("click",()=>{window.location.href=`../pages/livro/livroPagina.html?id=${e.id}`}),t.appendChild(n),t.appendChild(a),t.appendChild(o),t.appendChild(i),t.appendChild(d),t}function W(e,t){e.innerHTML="";const n=document.createElement("div");n.className="tooltip-box",n.textContent=t?`Nenhum resultado encontrado para "${t}".`:"Nenhum anúncio encontrado.",e.appendChild(n)}async function w(e){const t=await z(e),n=document.getElementById("cards-grid");if(n){if(n.innerHTML="",!t||Array.isArray(t)&&t.length===0){W(n,e);return}t.forEach(o=>{n.appendChild(G(o))})}}function _(){const e=document.getElementById("popup-input"),t=document.querySelector(".top-nav .btn");if(e){e.addEventListener("keydown",a=>{if(a.key==="Enter"){const r=e.value.trim();w(r)}});const o=((a,r=300)=>{let i;return(...s)=>{i&&window.clearTimeout(i),i=window.setTimeout(()=>a(...s),r)}})(()=>{const a=e.value.trim();w(a===""?void 0:a)},300);e.addEventListener("input",o)}t&&t.addEventListener("click",n=>{if(n.preventDefault(),e){e.focus();const o=e.value.trim();o!==""&&setTimeout(()=>w(o),100)}})}document.addEventListener("DOMContentLoaded",()=>{w(),_()});const m=document.getElementById("signout-btn"),u=document.getElementById("userArea");X();j();async function X(){try{const{data:e}=await f.auth.getUser();e?.user?(m&&(m.style.display="block"),u&&(u.style.display="block")):(m&&(m.style.display="none"),u&&(u.innerText="Faça login",u.href="../pages/login/login.html"))}catch(e){console.error("Erro ao checar autenticação:",e)}}m&&m.addEventListener("click",async e=>{e.preventDefault();try{const{error:t}=await f.auth.signOut();m&&(m.style.display="none"),u&&(u.innerText="Faça login",u.href="../pages/login/login.html")}catch(t){console.error("Erro no fluxo de signOut:",t),c("Erro ao sair. Veja o console para detalhes.",3e3,0)}});const B=document.getElementById("menu-toggle"),M=document.getElementById("sidebar"),I=document.getElementById("sidebar-overlay"),p=document.getElementById("sidebar-close");function J(){M.classList.add("active"),I.classList.add("active"),B.classList.add("active"),document.body.style.overflow="hidden",window.innerWidth<=768&&p&&(p.style.display="block")}function h(){M.classList.remove("active"),I.classList.remove("active"),B.classList.remove("active"),document.body.style.overflow="",p&&(p.style.display="none")}B&&B.addEventListener("click",()=>{M.classList.contains("active")?h():J()});I&&I.addEventListener("click",h);p&&p.addEventListener("click",h);const K=M.querySelectorAll("a");K.forEach(e=>{e.addEventListener("click",()=>{window.innerWidth<=768&&h()})});window.addEventListener("resize",()=>{window.innerWidth>768&&(h(),p&&(p.style.display="none"))});document.addEventListener("DOMContentLoaded",()=>{document.body.style.overflowX="hidden"});const C=document.getElementById("search-icon"),T=document.getElementById("close-search"),x=document.getElementById("popup-search-container"),v=document.getElementById("popup-input"),P=document.getElementById("logo-header");let E=!1;function Q(){E||(E=!0,x.classList.add("active"),P.classList.add("hidden"),T.classList.add("active"),C.style.display="none",setTimeout(()=>{v.focus()},300))}function D(){E&&(E=!1,x.classList.remove("active"),P.classList.remove("hidden"),T.classList.remove("active"),C.style.display="block")}C&&C.addEventListener("click",e=>{e.preventDefault(),Q()});T&&T.addEventListener("click",()=>{D()});document.addEventListener("keydown",e=>{e.key==="Escape"&&E&&D()});v&&(v.addEventListener("keydown",e=>{e.key==="Enter"&&E&&(console.log("Pesquisando:",v.value),setTimeout(()=>{D()},500))}),v.addEventListener("blur",()=>{setTimeout(()=>{E&&document.activeElement!==v&&D()},200)}));x&&x.addEventListener("click",e=>{e.stopPropagation()});const A=document.getElementById("form-cadastrar-livro");let y=[],l=[];function k(){const e=document.getElementById("image-preview");e&&(e.innerHTML="",y.forEach((t,n)=>{const o=new FileReader;o.onload=a=>{const r=document.createElement("div");r.className="image-preview-item";const i=document.createElement("img");i.src=a.target?.result;const s=document.createElement("button");s.className="image-preview-remove",s.innerHTML="×",s.type="button",s.style=`
            width: 30%;
            background: #737373;
            border: none;
            color: #ffffff;
      `,s.onclick=()=>{y.splice(n,1),k(),Y()},r.appendChild(i),r.appendChild(s),e.appendChild(r)},o.readAsDataURL(t)}))}function N(){const e=document.getElementById("generos-tags");e&&(e.innerHTML="",l.forEach((t,n)=>{const o=document.createElement("div");o.className="genero-tag";const a=document.createElement("span");a.textContent=t;const r=document.createElement("button");r.className="genero-tag-remove",r.innerHTML="×",r.type="button",r.onclick=()=>{l.splice(n,1),N()},o.appendChild(a),o.appendChild(r),e.appendChild(o)}))}function Y(){const e=document.getElementById("imagem");if(!e)return;const t=new DataTransfer;y.forEach(n=>t.items.add(n)),e.files=t.files}async function Z(e){const t=[];for(let n=0;n<Math.min(e.length,5);n++){const o=e[n],a=o.name.split(".").pop(),r=`public/${Date.now()}-${Math.random().toString(36).substring(2,8)}.${a}`,{data:i,error:s}=await f.storage.from("livros").upload(r,o);if(s)throw console.error("Erro ao fazer upload:",s),s;if(!i)throw console.error("Upload retornou sem dados"),new Error("Falha no upload da imagem");const{data:d}=f.storage.from("livros").getPublicUrl(r);if(d?.publicUrl)t.push(d.publicUrl);else throw console.error("Não foi possível obter URL pública"),new Error("Falha ao obter URL da imagem")}return t}if(A){const e=document.getElementById("imagem"),t=document.getElementById("genero-input");t&&t.addEventListener("keydown",n=>{if(n.key==="Enter"){n.preventDefault();const o=t.value.trim();if(o==="")return;if(l.length>=10){c("Você pode adicionar no máximo 10 gêneros.",3e3,0);return}if(l.includes(o)){c("Este gênero já foi adicionado.",3e3,0);return}l.push(o),N(),t.value=""}}),e&&e.addEventListener("change",n=>{const o=n.target.files;if(o){if(o.length>5){c("Você pode selecionar no máximo 5 imagens.",3e3,0),e.value="",y=[],k();return}y=Array.from(o),k()}}),A.addEventListener("submit",async n=>{n.preventDefault();const o=document.getElementById("titulo").value,a=document.getElementById("autora").value,r=parseInt(document.getElementById("paginas").value,10),i=document.getElementById("editora").value,s=document.getElementById("sobre").value,b=document.getElementById("imagem").files;if(!b||b.length===0){c("Selecione pelo menos uma imagem.",3e3,0);return}if(b.length>5){c("Você pode enviar no máximo 5 imagens.",3e3,0);return}if(l.length===0){c("Adicione pelo menos um gênero literário.",3e3,0);return}try{const{data:L,error:U}=await f.auth.getUser();if(U||!L?.user){c("Usuário não autenticado.",3e3,0),console.error("Erro de autenticação:",U);return}const R=L.user.id;let H=[];try{H=await Z(b)}catch(V){c("Erro ao fazer upload das imagens. Tente novamente.",3e3,0),console.error("Erro upload imagens:",V);return}const{data:$,error:F}=await f.from("anuncios").insert([{user_id:R,titulo:o,autora:a,paginas:r,editora:i,sobre:s,imagens:H,generos:l}]);if(F){c("Erro ao inserir no banco.",3e3,0),console.error("Erro insert:",F);return}console.log("Insert data:",$),c("Livro cadastrado com sucesso!",3e3,1),A.reset(),y=[],l=[],k(),N();const O=document.getElementById("add-book-modal");O&&(O.classList.remove("active"),document.body.style.overflow=""),window.location.reload()}catch(L){c("Erro inesperado ao cadastrar livro.",3e3,0),console.error("Erro inesperado:",L)}})}const S=document.getElementById("add-book-btn"),g=document.getElementById("add-book-modal"),q=document.getElementById("close-add-book-modal");S&&S.addEventListener("click",()=>{g.classList.add("active"),document.body.style.overflow="hidden"});q&&q.addEventListener("click",()=>{g.classList.remove("active"),document.body.style.overflow=""});g?.addEventListener("click",e=>{e.target===g&&(g.classList.remove("active"),document.body.style.overflow="")});document.addEventListener("keydown",e=>{e.key==="Escape"&&g?.classList.contains("active")&&(g.classList.remove("active"),document.body.style.overflow="")});document.getElementById("imagem");document.getElementById("image-preview");
