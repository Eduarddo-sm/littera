import{s as u}from"./supabase-BafKp-QD.js";import{a as m}from"./auth-DEmvCrfm.js";import"./login-CkW8Yrgw.js";async function p(t){try{let e=u.from("anuncios").select("id, titulo, autora, paginas, editora, sobre, imagens, status").or("status.eq.EM ABERTO,status.is.null");if(t&&t.trim()!==""){const a=t.trim();e=e.ilike("titulo",`%${a}%`)}const{data:n,error:o}=await e;return o?(console.error("Erro ao buscar livros:",o),[]):n||[]}catch(e){return console.error("Erro inesperado ao buscar livros:",e),[]}}function f(t){const e=document.createElement("div");e.className="card",e.style.position="relative";const n=document.createElement("img");n.className="card-thumb",n.src=t.imagens&&t.imagens.length>0?t.imagens[0]:"",n.alt=t.titulo;const o=document.createElement("h3");o.textContent=t.titulo;const a=document.createElement("div");a.className="card-meta";const i=[];t.status&&i.push(t.status),a.textContent=i.join(" ");const c=document.createElement("p");c.textContent=t.sobre;const d=document.createElement("button");return d.className="more",d.textContent="Ver mais",d.addEventListener("click",()=>{window.location.href=`../pages/livro/livroPagina.html?id=${t.id}`}),e.appendChild(n),e.appendChild(a),e.appendChild(o),e.appendChild(c),e.appendChild(d),e}function h(t,e){t.innerHTML="";const n=document.createElement("div");n.className="tooltip-box",n.textContent=e?`Nenhum resultado encontrado para "${e}".`:"Nenhum anúncio encontrado.",t.appendChild(n)}async function l(t){const e=await p(t),n=document.getElementById("cards-grid");if(n){if(n.innerHTML="",!e||Array.isArray(e)&&e.length===0){h(n,t);return}e.forEach(o=>{n.appendChild(f(o))})}}function g(){const t=document.getElementById("popup-input"),e=document.querySelector(".top-nav .btn");if(t){t.addEventListener("keydown",a=>{if(a.key==="Enter"){const i=t.value.trim();l(i)}});const o=((a,i=300)=>{let c;return(...d)=>{c&&window.clearTimeout(c),c=window.setTimeout(()=>a(...d),i)}})(()=>{const a=t.value.trim();l(a===""?void 0:a)},300);t.addEventListener("input",o)}e&&e.addEventListener("click",n=>{if(n.preventDefault(),t){t.focus();const o=t.value.trim();o!==""&&setTimeout(()=>l(o),100)}})}document.addEventListener("DOMContentLoaded",()=>{l(),g()});const s=document.getElementById("signout-btn"),r=document.getElementById("userArea");E();m();async function E(){try{const{data:t}=await u.auth.getUser();t?.user?(s&&(s.style.display="block"),r&&(r.style.display="block")):(s&&(s.style.display="none"),r&&(r.innerText="Faça login",r.href="../pages/login/login.html"))}catch(t){console.error("Erro ao checar autenticação:",t)}}s&&s.addEventListener("click",async t=>{t.preventDefault();try{const{error:e}=await u.auth.signOut();s&&(s.style.display="none"),r&&(r.innerText="Faça login",r.href="../pages/login/login.html")}catch(e){console.error("Erro no fluxo de signOut:",e),alert("Erro ao sair. Veja o console para detalhes.")}});
