import{s as o,a as d}from"./popup-B9BBiTrj.js";/* empty css              */import{a as P}from"./auth-MsIIcA0s.js";const f=document.getElementById("user-name"),y=document.getElementById("user-fullname"),E=document.getElementById("user-email"),v=document.getElementById("user-phone"),p=document.getElementById("user-bio");async function B(){const{data:e,error:t}=await o.auth.getUser(),r=e?.user;if(t){console.error(t);return}if(!r){P();return}const{data:a,error:l}=await o.from("profiles").select("*").eq("id",r.id).single();if(l){console.error(l);return}f&&(f.innerText=a.username||""),y&&(y.innerText=a.name||""),E&&(E.innerText=a.email||""),v&&(v.innerText=a.phone||""),p&&(p.innerText=a.bio||"")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{B().catch(e=>console.error("Erro ao carregar dados do usuário:",e))}):B().catch(e=>console.error("Erro ao carregar dados do usuário:",e));let n=null,i=null;const c=document.getElementById("view-mode"),g=document.getElementById("edit-mode"),U=document.getElementById("edit-profile-btn"),x=document.getElementById("cancel-edit-btn"),I=document.getElementById("edit-profile-form"),m=document.getElementById("edit-avatar"),b=document.getElementById("avatar-preview"),k=document.getElementById("edit-bio");async function h(){try{const{data:{user:e}}=await o.auth.getUser();if(!e){window.location.href="/src/pages/login/login.html";return}const{data:t,error:r}=await o.from("profiles").select("*").eq("id",e.id).single();if(r)throw r;n=t,w(t)}catch(e){console.error("Erro ao carregar perfil:",e),d("Erro ao carregar perfil do usuário",3e3,0)}}function w(e){const t=document.getElementById("user-name"),r=document.getElementById("user-fullname"),a=document.getElementById("user-email"),l=document.getElementById("user-phone");document.getElementById("user-bio");const u=document.getElementById("user-avatar");if(t.textContent=e.username||"Username",r.textContent=e.name||"Nome não informado",a.textContent=e.email||"Email não informado",l.textContent=e.phone||"Telefone não informado",e.avatar_url){const s=o.storage.from("userProfiles").getPublicUrl(e.avatar_url).data.publicUrl;u.style.backgroundImage=`url(${s})`}if(document.getElementById("edit-username").value=e.username||"",document.getElementById("edit-fullname").value=e.name||"",document.getElementById("edit-email").value=e.email||"",document.getElementById("edit-phone").value=e.phone||"",e.avatar_url){const s=o.storage.from("userProfiles").getPublicUrl(e.avatar_url).data.publicUrl;b.style.backgroundImage=`url(${s})`}}m.addEventListener("change",e=>{const t=e.target.files?.[0];if(t){if(!["image/jpeg","image/jpg","image/png"].includes(t.type)){d("Por favor, selecione uma imagem JPG ou PNG",3e3,0),m.value="";return}if(t.size>5*1024*1024){d("A imagem deve ter no máximo 5MB",3e3,0),m.value="";return}i=t;const r=new FileReader;r.onload=a=>{b.style.backgroundImage=`url(${a.target?.result})`},r.readAsDataURL(t)}});U.addEventListener("click",()=>{c.style.display="none",g.style.display="block"});x.addEventListener("click",()=>{g.style.display="none",c.style.display="block",i=null,n&&w(n)});I.addEventListener("submit",async e=>{if(e.preventDefault(),!n)return;const t=I.querySelector('button[type="submit"]');t.disabled=!0,t.textContent="Salvando...";try{let r=n.avatar_url;if(i){n.avatar_url&&await o.storage.from("userProfiles").remove([n.avatar_url]);const l=i.name.split(".").pop(),u=`public/${n.id}-${Date.now()}.${l}`,{error:s}=await o.storage.from("userProfiles").upload(u,i);if(s)throw s;r=u}const{error:a}=await o.from("profiles").update({username:document.getElementById("edit-username").value,name:document.getElementById("edit-fullname").value,phone:document.getElementById("edit-phone").value,avatar_url:r,bio:k.value}).eq("id",n.id);if(a)throw a;d("Perfil atualizado com sucesso!",3e3,1),await h(),g.style.display="none",c.style.display="block",i=null}catch(r){console.error("Erro ao salvar perfil:",r),d("Erro ao salvar alterações. Tente novamente.",3e3,0)}finally{t.disabled=!1,t.textContent="Salvar Alterações",window.location.reload()}});h();
