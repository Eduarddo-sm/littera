import{s as c,a as i}from"./popup-BbttVVEm.js";/* empty css              */let l=[],d=!1;function p(){return new URLSearchParams(window.location.search).get("id")}async function E(t){try{if(!t){const{data:a,error:o}=await c.auth.getUser();if(o||!a?.user)return i("Você precisa estar logado para ver esta página",3e3,0),window.location.href="/pages/login/login.html",null;t=a.user.id}const{data:e,error:r}=await c.from("profiles").select("*").eq("id",t).single();return r?(console.error("Erro ao buscar perfil:",r),i("Perfil não encontrado",3e3,0),null):e}catch(e){return console.error("Erro ao carregar perfil:",e),i("Erro ao carregar perfil",3e3,0),null}}async function y(t){try{const{data:e,error:r}=await c.from("anuncios").select("*").eq("user_id",t).order("created_at",{ascending:!1});return r?(console.error("Erro ao buscar anúncios:",r),i("Erro ao carregar anúncios",3e3,0),[]):e}catch(e){return console.error("Erro ao carregar anúncios:",e),[]}}function b(t){const e=document.getElementById("user-avatar"),r=document.getElementById("user-name"),a=document.getElementById("user-username"),o=document.getElementById("user-bio");if(e)if(t.avatar_url){const{data:s}=c.storage.from("userProfiles").getPublicUrl(t.avatar_url);e.src=s.publicUrl,e.style.objectFit="cover"}else e.src="../../images/default-avatar.png";r&&(r.textContent=t.name||"Usuário Littera"),a&&(a.textContent=t.username?`${t.username}`:""),o&&(o.textContent=t.bio||"Sem biografia");const n=document.querySelector(".filter-container h2");n&&(n.textContent=d?"Minha Loja":`Loja de ${t.name||t.username||"Usuário"}`)}function v(t){const e=document.getElementById("total-anuncios"),r=document.getElementById("total-abertos"),a=document.getElementById("total-fechados"),o=t.filter(s=>s.status==="EM ABERTO").length,n=t.filter(s=>s.status==="FECHADO").length;e&&(e.textContent=t.length.toString()),r&&(r.textContent=o.toString()),a&&(a.textContent=n.toString())}function w(t){try{const e=new Date(t),r={day:"2-digit",month:"short",year:"numeric"};return e.toLocaleDateString("pt-BR",r)}catch{return"Data não disponível"}}function u(t){const e=document.getElementById("books-grid"),r=document.getElementById("loading-state"),a=document.getElementById("empty-state");if(!e||!r||!a){console.error("Elementos não encontrados no DOM");return}if(r.style.display="none",t.length===0){a.style.display="block",e.innerHTML="";return}a.style.display="none",e.innerHTML="",t.forEach(o=>{const n=document.createElement("div");n.className="book-card",n.onclick=()=>{window.location.href=`/pages/livro/livroPagina.html?id=${o.id}`};const s=o.status==="EM ABERTO"?"aberto":"fechado",g=o.status==="EM ABERTO"?"Em Aberto":"Fechado",m=o.imagens&&o.imagens.length>0?o.imagens[0]:"../../images/default-book.png",f=o.generos&&o.generos.length>0?o.generos.slice(0,3).map(h=>`<span class="genre-tag">${h}</span>`).join(""):'<span class="genre-tag">Sem gênero</span>';n.innerHTML=`
      <div class="book-status ${s}">${g}</div>
      <img src="${m}" alt="${o.titulo}" class="book-image" onerror="this.src='../../images/default-book.png'">
      <div class="book-content">
        <h3 class="book-title">${o.titulo}</h3>
        <p class="book-author">por ${o.autora||"Autor desconhecido"}</p>
        <div class="book-genres">
          ${f}
        </div>
        <p class="book-date">Anunciado em ${w(o.created_at)}</p>
      </div>
    `,e.appendChild(n)})}function A(t){let e;t==="todos"?e=l:e=l.filter(r=>r.status===t),u(e)}function B(){const t=document.querySelectorAll(".filter-btn");t.forEach(e=>{e.addEventListener("click",()=>{t.forEach(a=>a.classList.remove("active")),e.classList.add("active");const r=e.getAttribute("data-filter")||"todos";A(r)})})}async function k(){const t=p();let e=null;if(t){e=t;const{data:a}=await c.auth.getUser();d=a?.user?.id===t}else{const{data:a,error:o}=await c.auth.getUser();if(a?.user)e=a.user.id,d=!0;else{console.error("Erro ao obter usuário:",o),i("Você precisa estar logado",3e3,0),setTimeout(()=>{window.location.href="/pages/login/login.html"},3e3);return}}if(!e){i("Usuário não encontrado",3e3,0);return}const r=await E(e);if(!r){console.error("Perfil não encontrado");return}b(r),l=await y(e),v(l),u(l),B()}document.addEventListener("DOMContentLoaded",k);
