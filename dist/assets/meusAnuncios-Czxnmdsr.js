import{s as i}from"./supabase-BafKp-QD.js";const c=document.getElementById("form-cadastrar-livro");async function v(a){const o=[];for(let t=0;t<Math.min(a.length,5);t++){const n=a[t],l=n.name.split(".").pop(),s=`public/${Date.now()}-${Math.random().toString(36).substring(2,8)}.${l}`,{data:p,error:r}=await i.storage.from("livros").upload(s,n);if(r)throw r;const{data:e}=i.storage.from("livros").getPublicUrl(s);o.push(e.publicUrl)}return o}c&&c.addEventListener("submit",async a=>{a.preventDefault();const o=document.getElementById("titulo").value,t=document.getElementById("autora").value,n=parseInt(document.getElementById("paginas").value,10),l=document.getElementById("editora").value,s=document.getElementById("sobre").value,r=document.getElementById("imagem").files;if(!r||r.length===0){alert("Selecione pelo menos uma imagem.");return}try{const{data:e,error:m}=await i.auth.getUser();if(m||!e?.user){alert("Usuário não autenticado."),console.error("Erro de autenticação:",m);return}const f=e.user.id;let d=[];try{d=await v(r)}catch(g){alert("Erro ao fazer upload das imagens: "+g.message),console.error("Erro upload imagens:",g);return}const{data:E,error:u}=await i.from("anuncios").insert([{user_id:f,titulo:o,autora:t,paginas:n,editora:l,sobre:s,imagens:d}]);if(u){alert("Erro ao inserir no banco: "+u.message),console.error("Erro insert:",u);return}console.log("Insert data:",E),alert("Livro cadastrado com sucesso!"),c.reset()}catch(e){alert("Erro inesperado ao cadastrar livro: "+e.message),console.error("Erro inesperado:",e)}});
