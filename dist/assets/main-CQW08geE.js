import{s as h,a as B}from"./popup-B9BBiTrj.js";/* empty css              */import{a as C}from"./auth-MsIIcA0s.js";import"./login-BpsihPwV.js";async function I(e){try{const{data:{user:t}}=await h.auth.getUser();let n=h.from("anuncios").select("id, titulo, autora, paginas, editora, sobre, imagens, status, user_id").or("status.eq.EM ABERTO,status.is.null,status.eq.FECHADO");if(t&&(n=n.neq("user_id",t.id)),e&&e.trim()!==""){const a=e.trim();n=n.ilike("titulo",`%${a}%`)}const{data:o,error:s}=await n;return s?(console.error("Erro ao buscar livros:",s),[]):o||[]}catch(t){return console.error("Erro inesperado ao buscar livros:",t),[]}}function T(e){const t=document.createElement("div");t.className="card",t.style.position="relative";const n=document.createElement("img");n.className="card-thumb",n.src=e.imagens&&e.imagens.length>0?e.imagens[0]:"",n.alt=e.titulo;const o=document.createElement("h3");o.textContent=e.titulo;const s=document.createElement("div");s.className="card-meta";const a=[];e.status&&a.push(e.status),e.status==="FECHADO"&&(s.style.color="#bb0000ff",s.style.background="#ffa9a9d5"),s.textContent=a.join(" ");const l=document.createElement("p");l.textContent=e.sobre;const u=document.createElement("button");return u.className="more",u.textContent="Ver mais",u.addEventListener("click",()=>{window.location.href=`../pages/livro/livroPagina.html?id=${e.id}`}),t.appendChild(n),t.appendChild(s),t.appendChild(o),t.appendChild(l),t.appendChild(u),t}function A(e,t){e.innerHTML="";const n=document.createElement("div");n.className="tooltip-box",n.textContent=t?`Nenhum resultado encontrado para "${t}".`:"Nenhum anúncio encontrado.",e.appendChild(n)}async function p(e){const t=await I(e),n=document.getElementById("cards-grid");if(n){if(n.innerHTML="",!t||Array.isArray(t)&&t.length===0){A(n,e);return}t.forEach(o=>{n.appendChild(T(o))})}}function x(){const e=document.getElementById("popup-input"),t=document.querySelector(".top-nav .btn");if(e){e.addEventListener("keydown",s=>{if(s.key==="Enter"){const a=e.value.trim();p(a)}});const o=((s,a=300)=>{let l;return(...u)=>{l&&window.clearTimeout(l),l=window.setTimeout(()=>s(...u),a)}})(()=>{const s=e.value.trim();p(s===""?void 0:s)},300);e.addEventListener("input",o)}t&&t.addEventListener("click",n=>{if(n.preventDefault(),e){e.focus();const o=e.value.trim();o!==""&&setTimeout(()=>p(o),100)}})}document.addEventListener("DOMContentLoaded",()=>{p(),x()});const c=document.getElementById("signout-btn"),i=document.getElementById("userArea");O();C();async function O(){try{const{data:e}=await h.auth.getUser();e?.user?(c&&(c.style.display="block"),i&&(i.style.display="block")):(c&&(c.style.display="none"),i&&(i.innerText="Faça login",i.href="../pages/login/login.html"))}catch(e){console.error("Erro ao checar autenticação:",e)}}c&&c.addEventListener("click",async e=>{e.preventDefault();try{const{error:t}=await h.auth.signOut();c&&(c.style.display="none"),i&&(i.innerText="Faça login",i.href="../pages/login/login.html")}catch(t){console.error("Erro no fluxo de signOut:",t),B("Erro ao sair. Veja o console para detalhes.",3e3,0)}});const y=document.getElementById("menu-toggle"),k=document.getElementById("sidebar"),E=document.getElementById("sidebar-overlay"),r=document.getElementById("sidebar-close");function N(){k.classList.add("active"),E.classList.add("active"),y.classList.add("active"),document.body.style.overflow="hidden",window.innerWidth<=768&&r&&(r.style.display="block")}function f(){k.classList.remove("active"),E.classList.remove("active"),y.classList.remove("active"),document.body.style.overflow="",r&&(r.style.display="none")}y&&y.addEventListener("click",()=>{k.classList.contains("active")?f():N()});E&&E.addEventListener("click",f);r&&r.addEventListener("click",f);const D=k.querySelectorAll("a");D.forEach(e=>{e.addEventListener("click",()=>{window.innerWidth<=768&&f()})});window.addEventListener("resize",()=>{window.innerWidth>768&&(f(),r&&(r.style.display="none"))});document.addEventListener("DOMContentLoaded",()=>{document.body.style.overflowX="hidden"});const v=document.getElementById("search-icon"),g=document.getElementById("close-search"),L=document.getElementById("popup-search-container"),m=document.getElementById("popup-input"),w=document.getElementById("logo-header");let d=!1;function M(){d||(d=!0,L.classList.add("active"),w.classList.add("hidden"),g.classList.add("active"),v.style.display="none",setTimeout(()=>{m.focus()},300))}function b(){d&&(d=!1,L.classList.remove("active"),w.classList.remove("hidden"),g.classList.remove("active"),v.style.display="block")}v&&v.addEventListener("click",e=>{e.preventDefault(),M()});g&&g.addEventListener("click",()=>{b()});document.addEventListener("keydown",e=>{e.key==="Escape"&&d&&b()});m&&(m.addEventListener("keydown",e=>{e.key==="Enter"&&d&&(console.log("Pesquisando:",m.value),setTimeout(()=>{b()},500))}),m.addEventListener("blur",()=>{setTimeout(()=>{d&&document.activeElement!==m&&b()},200)}));L&&L.addEventListener("click",e=>{e.stopPropagation()});
