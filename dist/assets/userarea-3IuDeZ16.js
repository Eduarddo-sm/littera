import{s as t}from"./supabase-C7rZz57M.js";import{a as w}from"./guard-SrXEI54j.js";const d=document.getElementById("user-name"),u=document.getElementById("user-fullname"),m=document.getElementById("user-email"),f=document.getElementById("user-phone"),h=document.getElementById("user-bio"),g=document.getElementById("delete-account");async function p(){const{data:e,error:s}=await t.auth.getUser(),a=e?.user;if(s){console.error(s);return}if(!a){w();return}const{data:o,error:r}=await t.from("profiles").select("*").eq("id",a.id).single();if(r){console.error(r);return}d&&(d.innerText=o.username||""),u&&(u.innerText=o.name||""),m&&(m.innerText=o.email||""),f&&(f.innerText=o.phone||""),h&&(h.innerText=o.bio||"")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{p().catch(e=>console.error("Erro ao carregar dados do usuário:",e))}):p().catch(e=>console.error("Erro ao carregar dados do usuário:",e));g?.addEventListener("click",async e=>{if(e.preventDefault(),!confirm("Tem certeza que deseja apagar sua conta? Esta ação é irreversível."))return;const{data:{user:a}}=await t.auth.getUser();if(!a){alert("Usuário não autenticado.");return}const{data:o,error:r}=await t.auth.getSession(),i=o?.session?.access_token;if(r||!i){console.error("Erro ao obter token de sessão:",r),alert("Não foi possível obter credenciais para deletar a conta. Faça login novamente e tente novamente.");return}try{const c=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?`${window.location.protocol}//${window.location.host}`:`https://${window.location.host}`,n=await fetch(`${c}/api/delete-account`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({})});if(!n.ok){const l=await n.json().catch(()=>null);console.error("Erro ao deletar conta (server):",n.status,l),alert(`Erro ao deletar conta: ${l?.error||"Erro desconhecido"}. Veja o console para mais detalhes.`);return}const E=await n.json();console.log("Conta deletada com sucesso:",E),await t.auth.signOut(),alert("Conta deletada com sucesso!"),window.location.href="../../index.html"}catch(c){console.error("Erro na requisição de delete-account:",c),alert("Erro ao conectar com o servidor para deletar conta. Veja o console para detalhes.")}});
