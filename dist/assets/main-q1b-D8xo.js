import{s as l}from"./supabase-DontodQT.js";import{a as m}from"./auth-DHS0uDGa.js";import"./login-wwfB6Gfa.js";async function p(t){try{let e=l.from("anuncios").select("id, titulo, autora, paginas, editora, sobre, imagens, status").or("status.eq.EM ABERTO,status.is.null,status.eq.FECHADO");if(t&&t.trim()!==""){const o=t.trim();e=e.ilike("titulo",`%${o}%`)}const{data:n,error:a}=await e;return a?(console.error("Erro ao buscar livros:",a),[]):n||[]}catch(e){return console.error("Erro inesperado ao buscar livros:",e),[]}}function f(t){const e=document.createElement("div");e.className="card",e.style.position="relative";const n=document.createElement("img");n.className="card-thumb",n.src=t.imagens&&t.imagens.length>0?t.imagens[0]:"",n.alt=t.titulo;const a=document.createElement("h3");a.textContent=t.titulo;const o=document.createElement("div");o.className="card-meta";const i=[];t.status&&i.push(t.status),t.status==="FECHADO"&&(o.style.color="#bb0000ff",o.style.background="#ffa9a9d5"),o.textContent=i.join(" ");const c=document.createElement("p");c.textContent=t.sobre;const d=document.createElement("button");return d.className="more",d.textContent="Ver mais",d.addEventListener("click",()=>{window.location.href=`../pages/livro/livroPagina.html?id=${t.id}`}),e.appendChild(n),e.appendChild(o),e.appendChild(a),e.appendChild(c),e.appendChild(d),e}function h(t,e){t.innerHTML="";const n=document.createElement("div");n.className="tooltip-box",n.textContent=e?`Nenhum resultado encontrado para "${e}".`:"Nenhum anúncio encontrado.",t.appendChild(n)}async function u(t){const e=await p(t),n=document.getElementById("cards-grid");if(n){if(n.innerHTML="",!e||Array.isArray(e)&&e.length===0){h(n,t);return}e.forEach(a=>{n.appendChild(f(a))})}}function g(){const t=document.getElementById("popup-input"),e=document.querySelector(".top-nav .btn");if(t){t.addEventListener("keydown",o=>{if(o.key==="Enter"){const i=t.value.trim();u(i)}});const a=((o,i=300)=>{let c;return(...d)=>{c&&window.clearTimeout(c),c=window.setTimeout(()=>o(...d),i)}})(()=>{const o=t.value.trim();u(o===""?void 0:o)},300);t.addEventListener("input",a)}e&&e.addEventListener("click",n=>{if(n.preventDefault(),t){t.focus();const a=t.value.trim();a!==""&&setTimeout(()=>u(a),100)}})}document.addEventListener("DOMContentLoaded",()=>{u(),g()});const s=document.getElementById("signout-btn"),r=document.getElementById("userArea");E();m();async function E(){try{const{data:t}=await l.auth.getUser();t?.user?(s&&(s.style.display="block"),r&&(r.style.display="block")):(s&&(s.style.display="none"),r&&(r.innerText="Faça login",r.href="../pages/login/login.html"))}catch(t){console.error("Erro ao checar autenticação:",t)}}s&&s.addEventListener("click",async t=>{t.preventDefault();try{const{error:e}=await l.auth.signOut();s&&(s.style.display="none"),r&&(r.innerText="Faça login",r.href="../pages/login/login.html")}catch(e){console.error("Erro no fluxo de signOut:",e),alert("Erro ao sair. Veja o console para detalhes.")}});
