import{s as g,c as U}from"./supabase-B9cvm4hE.js";/* empty css              */import{a as x}from"./auth-DL7f-0Iv.js";const f=document.getElementById("user-name"),y=document.getElementById("user-fullname"),E=document.getElementById("user-email"),p=document.getElementById("user-phone"),I=document.getElementById("user-bio");async function v(){const{data:e,error:t}=await g.auth.getUser(),r=e?.user;if(t){console.error(t);return}if(!r){x();return}const{data:a,error:l}=await g.from("profiles").select("*").eq("id",r.id).single();if(l){console.error(l);return}f&&(f.innerText=a.username||""),y&&(y.innerText=a.name||""),E&&(E.innerText=a.email||""),p&&(p.innerText=a.phone||""),I&&(I.innerText=a.bio||"")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{v().catch(e=>console.error("Erro ao carregar dados do usuário:",e))}):v().catch(e=>console.error("Erro ao carregar dados do usuário:",e));const P="https://kqepdklhdblxbslyhzhv.supabase.co",k="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtxZXBka2xoZGJseGJzbHloemh2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk0NTYzODcsImV4cCI6MjA3NTAzMjM4N30.sW6NYNjItYjGaTc1oC06Id-c5rsYoZcQpXFlbcj-nBI",o=U(P,k);let n=null,i=null;const c=document.getElementById("view-mode"),m=document.getElementById("edit-mode"),C=document.getElementById("edit-profile-btn"),N=document.getElementById("cancel-edit-btn"),b=document.getElementById("edit-profile-form"),u=document.getElementById("edit-avatar"),B=document.getElementById("avatar-preview"),T=document.getElementById("edit-bio");async function h(){try{const{data:{user:e}}=await o.auth.getUser();if(!e){window.location.href="/src/pages/login/login.html";return}const{data:t,error:r}=await o.from("profiles").select("*").eq("id",e.id).single();if(r)throw r;n=t,w(t)}catch(e){console.error("Erro ao carregar perfil:",e),alert("Erro ao carregar perfil do usuário")}}function w(e){const t=document.getElementById("user-name"),r=document.getElementById("user-fullname"),a=document.getElementById("user-email"),l=document.getElementById("user-phone");document.getElementById("user-bio");const d=document.getElementById("user-avatar");if(t.textContent=e.username||"Username",r.textContent=e.name||"Nome não informado",a.textContent=e.email||"Email não informado",l.textContent=e.phone||"Telefone não informado",e.avatar_url){const s=o.storage.from("userProfiles").getPublicUrl(e.avatar_url).data.publicUrl;d.style.backgroundImage=`url(${s})`}if(document.getElementById("edit-username").value=e.username||"",document.getElementById("edit-fullname").value=e.name||"",document.getElementById("edit-email").value=e.email||"",document.getElementById("edit-phone").value=e.phone||"",e.avatar_url){const s=o.storage.from("userProfiles").getPublicUrl(e.avatar_url).data.publicUrl;B.style.backgroundImage=`url(${s})`}}u.addEventListener("change",e=>{const t=e.target.files?.[0];if(t){if(!["image/jpeg","image/jpg","image/png"].includes(t.type)){alert("Por favor, selecione uma imagem JPG ou PNG"),u.value="";return}if(t.size>5*1024*1024){alert("A imagem deve ter no máximo 5MB"),u.value="";return}i=t;const r=new FileReader;r.onload=a=>{B.style.backgroundImage=`url(${a.target?.result})`},r.readAsDataURL(t)}});C.addEventListener("click",()=>{c.style.display="none",m.style.display="block"});N.addEventListener("click",()=>{m.style.display="none",c.style.display="block",i=null,n&&w(n)});b.addEventListener("submit",async e=>{if(e.preventDefault(),!n)return;const t=b.querySelector('button[type="submit"]');t.disabled=!0,t.textContent="Salvando...";try{let r=n.avatar_url;if(i){n.avatar_url&&await o.storage.from("userProfiles").remove([n.avatar_url]);const l=i.name.split(".").pop(),d=`public/${n.id}-${Date.now()}.${l}`,{error:s}=await o.storage.from("userProfiles").upload(d,i);if(s)throw s;r=d}const{error:a}=await o.from("profiles").update({username:document.getElementById("edit-username").value,name:document.getElementById("edit-fullname").value,phone:document.getElementById("edit-phone").value,avatar_url:r,bio:T.value}).eq("id",n.id);if(a)throw a;alert("Perfil atualizado com sucesso!"),await h(),m.style.display="none",c.style.display="block",i=null}catch(r){console.error("Erro ao salvar perfil:",r),alert("Erro ao salvar alterações. Tente novamente.")}finally{t.disabled=!1,t.textContent="Salvar Alterações",window.location.reload()}});h();
