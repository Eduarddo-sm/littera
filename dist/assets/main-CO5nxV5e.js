import{s as l}from"./supabase-BafKp-QD.js";import{a as m}from"./auth-DEmvCrfm.js";import"./login-CkW8Yrgw.js";async function p(e){try{let t=l.from("anuncios").select("id, titulo, sobre, imagens");if(e&&e.trim()!==""){const r=e.trim();t=t.ilike("titulo",`%${r}%`)}const{data:n,error:o}=await t;return o?(console.error("Erro ao buscar livros:",o),[]):n||[]}catch(t){return console.error("Erro inesperado ao buscar livros:",t),[]}}function f(e){const t=document.createElement("div");t.className="card";const n=document.createElement("img");n.className="card-thumb",n.src=e.imagens&&e.imagens.length>0?e.imagens[0]:"",n.alt=e.titulo;const o=document.createElement("h3");o.textContent=e.titulo;const r=document.createElement("p");r.textContent=e.sobre;const a=document.createElement("button");return a.className="more",a.textContent="Ver mais",a.addEventListener("click",()=>{window.location.href=`../pages/livro/livroPagina.html?id=${e.id}`}),t.appendChild(n),t.appendChild(o),t.appendChild(r),t.appendChild(a),t}function h(e,t){e.innerHTML="";const n=document.createElement("div");n.className="tooltip-box",n.textContent=t?`Nenhum resultado encontrado para "${t}".`:"Nenhum anúncio encontrado.",e.appendChild(n)}async function c(e){const t=await p(e),n=document.getElementById("cards-grid");if(n){if(n.innerHTML="",!t||Array.isArray(t)&&t.length===0){h(n,e);return}t.forEach(o=>{n.appendChild(f(o))})}}function g(){const e=document.getElementById("popup-input"),t=document.querySelector(".top-nav .btn");if(e){e.addEventListener("keydown",r=>{if(r.key==="Enter"){const a=e.value.trim();c(a)}});const o=((r,a=300)=>{let d;return(...u)=>{d&&window.clearTimeout(d),d=window.setTimeout(()=>r(...u),a)}})(()=>{const r=e.value.trim();c(r===""?void 0:r)},300);e.addEventListener("input",o)}t&&t.addEventListener("click",n=>{if(n.preventDefault(),e){e.focus();const o=e.value.trim();o!==""&&setTimeout(()=>c(o),100)}})}document.addEventListener("DOMContentLoaded",()=>{c(),g()});const s=document.getElementById("signout-btn"),i=document.getElementById("userArea");E();m();async function E(){try{const{data:e}=await l.auth.getUser();e?.user?(s&&(s.style.display="block"),i&&(i.style.display="block")):(s&&(s.style.display="none"),i&&(i.innerText="Faça login",i.href="../pages/login/login.html"))}catch(e){console.error("Erro ao checar autenticação:",e)}}s&&s.addEventListener("click",async e=>{e.preventDefault();try{const{error:t}=await l.auth.signOut();s&&(s.style.display="none"),i&&(i.innerText="Faça login",i.href="../pages/login/login.html")}catch(t){console.error("Erro no fluxo de signOut:",t),alert("Erro ao sair. Veja o console para detalhes.")}});
