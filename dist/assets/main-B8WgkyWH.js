import{s as l}from"./supabase-DontodQT.js";import{a as m}from"./auth-DHS0uDGa.js";import"./login-wwfB6Gfa.js";async function p(t){try{const{data:{user:e}}=await l.auth.getUser();let n=l.from("anuncios").select("id, titulo, autora, paginas, editora, sobre, imagens, status, user_id").or("status.eq.EM ABERTO,status.is.null,status.eq.FECHADO");if(e&&(n=n.neq("user_id",e.id)),t&&t.trim()!==""){const s=t.trim();n=n.ilike("titulo",`%${s}%`)}const{data:o,error:a}=await n;return a?(console.error("Erro ao buscar livros:",a),[]):o||[]}catch(e){return console.error("Erro inesperado ao buscar livros:",e),[]}}function f(t){const e=document.createElement("div");e.className="card",e.style.position="relative";const n=document.createElement("img");n.className="card-thumb",n.src=t.imagens&&t.imagens.length>0?t.imagens[0]:"",n.alt=t.titulo;const o=document.createElement("h3");o.textContent=t.titulo;const a=document.createElement("div");a.className="card-meta";const s=[];t.status&&s.push(t.status),t.status==="FECHADO"&&(a.style.color="#bb0000ff",a.style.background="#ffa9a9d5"),a.textContent=s.join(" ");const c=document.createElement("p");c.textContent=t.sobre;const d=document.createElement("button");return d.className="more",d.textContent="Ver mais",d.addEventListener("click",()=>{window.location.href=`../pages/livro/livroPagina.html?id=${t.id}`}),e.appendChild(n),e.appendChild(a),e.appendChild(o),e.appendChild(c),e.appendChild(d),e}function h(t,e){t.innerHTML="";const n=document.createElement("div");n.className="tooltip-box",n.textContent=e?`Nenhum resultado encontrado para "${e}".`:"Nenhum anúncio encontrado.",t.appendChild(n)}async function u(t){const e=await p(t),n=document.getElementById("cards-grid");if(n){if(n.innerHTML="",!e||Array.isArray(e)&&e.length===0){h(n,t);return}e.forEach(o=>{n.appendChild(f(o))})}}function g(){const t=document.getElementById("popup-input"),e=document.querySelector(".top-nav .btn");if(t){t.addEventListener("keydown",a=>{if(a.key==="Enter"){const s=t.value.trim();u(s)}});const o=((a,s=300)=>{let c;return(...d)=>{c&&window.clearTimeout(c),c=window.setTimeout(()=>a(...d),s)}})(()=>{const a=t.value.trim();u(a===""?void 0:a)},300);t.addEventListener("input",o)}e&&e.addEventListener("click",n=>{if(n.preventDefault(),t){t.focus();const o=t.value.trim();o!==""&&setTimeout(()=>u(o),100)}})}document.addEventListener("DOMContentLoaded",()=>{u(),g()});const i=document.getElementById("signout-btn"),r=document.getElementById("userArea");E();m();async function E(){try{const{data:t}=await l.auth.getUser();t?.user?(i&&(i.style.display="block"),r&&(r.style.display="block")):(i&&(i.style.display="none"),r&&(r.innerText="Faça login",r.href="../pages/login/login.html"))}catch(t){console.error("Erro ao checar autenticação:",t)}}i&&i.addEventListener("click",async t=>{t.preventDefault();try{const{error:e}=await l.auth.signOut();i&&(i.style.display="none"),r&&(r.innerText="Faça login",r.href="../pages/login/login.html")}catch(e){console.error("Erro no fluxo de signOut:",e),alert("Erro ao sair. Veja o console para detalhes.")}});
