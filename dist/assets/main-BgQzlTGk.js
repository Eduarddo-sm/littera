import{s as u}from"./supabase-BafKp-QD.js";import{a as m}from"./auth-DEmvCrfm.js";import"./login-CkW8Yrgw.js";async function p(e){try{let t=u.from("anuncios").select("id, titulo, autora, paginas, editora, sobre, imagens, status");if(e&&e.trim()!==""){const a=e.trim();t=t.ilike("titulo",`%${a}%`)}const{data:n,error:o}=await t;return o?(console.error("Erro ao buscar livros:",o),[]):n||[]}catch(t){return console.error("Erro inesperado ao buscar livros:",t),[]}}function f(e){const t=document.createElement("div");t.className="card",t.style.position="relative";const n=document.createElement("img");n.className="card-thumb",n.src=e.imagens&&e.imagens.length>0?e.imagens[0]:"",n.alt=e.titulo;const o=document.createElement("h3");o.textContent=e.titulo;const a=document.createElement("div");a.className="card-meta";const i=[];e.status&&i.push(e.status),a.textContent=i.join(" ");const c=document.createElement("p");c.textContent=e.sobre;const d=document.createElement("button");return d.className="more",d.textContent="Ver mais",d.addEventListener("click",()=>{window.location.href=`../pages/livro/livroPagina.html?id=${e.id}`}),t.appendChild(n),t.appendChild(a),t.appendChild(o),t.appendChild(c),t.appendChild(d),t}function h(e,t){e.innerHTML="";const n=document.createElement("div");n.className="tooltip-box",n.textContent=t?`Nenhum resultado encontrado para "${t}".`:"Nenhum anúncio encontrado.",e.appendChild(n)}async function l(e){const t=await p(e),n=document.getElementById("cards-grid");if(n){if(n.innerHTML="",!t||Array.isArray(t)&&t.length===0){h(n,e);return}t.forEach(o=>{n.appendChild(f(o))})}}function g(){const e=document.getElementById("popup-input"),t=document.querySelector(".top-nav .btn");if(e){e.addEventListener("keydown",a=>{if(a.key==="Enter"){const i=e.value.trim();l(i)}});const o=((a,i=300)=>{let c;return(...d)=>{c&&window.clearTimeout(c),c=window.setTimeout(()=>a(...d),i)}})(()=>{const a=e.value.trim();l(a===""?void 0:a)},300);e.addEventListener("input",o)}t&&t.addEventListener("click",n=>{if(n.preventDefault(),e){e.focus();const o=e.value.trim();o!==""&&setTimeout(()=>l(o),100)}})}document.addEventListener("DOMContentLoaded",()=>{l(),g()});const s=document.getElementById("signout-btn"),r=document.getElementById("userArea");E();m();async function E(){try{const{data:e}=await u.auth.getUser();e?.user?(s&&(s.style.display="block"),r&&(r.style.display="block")):(s&&(s.style.display="none"),r&&(r.innerText="Faça login",r.href="../pages/login/login.html"))}catch(e){console.error("Erro ao checar autenticação:",e)}}s&&s.addEventListener("click",async e=>{e.preventDefault();try{const{error:t}=await u.auth.signOut();s&&(s.style.display="none"),r&&(r.innerText="Faça login",r.href="../pages/login/login.html")}catch(t){console.error("Erro no fluxo de signOut:",t),alert("Erro ao sair. Veja o console para detalhes.")}});
