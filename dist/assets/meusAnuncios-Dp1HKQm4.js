import{s as u,a as m}from"./popup-B9BBiTrj.js";/* empty css              */async function C(){try{const{data:{user:e}}=await u.auth.getUser();if(!e)return console.error("Usu√°rio n√£o autenticado"),[];const{data:n,error:t}=await u.from("anuncios").select("id, user_id, titulo, autora, paginas, editora, sobre, imagens, status").eq("user_id",e.id);return t?(console.error("Erro ao buscar an√∫ncios:",t),console.error("Detalhes do erro:",JSON.stringify(t,null,2)),[]):n||[]}catch(e){return console.error("Erro inesperado ao buscar an√∫ncios:",e),[]}}async function g(e,n){try{const t=n==="EM ABERTO"?"FECHADO":"EM ABERTO",{error:a}=await u.from("anuncios").update({status:t}).eq("id",e);return a?(console.error("Erro ao atualizar status:",a),m("Erro ao atualizar an√∫ncio. Tente novamente.",3e3,0),!1):!0}catch(t){return console.error("Erro inesperado:",t),m("Erro inesperado. Tente novamente.",3e3,0),!1}}function v(e){const n=document.createElement("div"),t=e.status||"EM ABERTO";n.className=`anuncio-card ${t==="FECHADO"?"fechado":""}`;const a=document.createElement("div");a.className="anuncio-header";const r=document.createElement("div");r.className="anuncio-titulo",r.textContent=e.titulo;const s=document.createElement("span");s.className=`anuncio-status-badge ${t==="EM ABERTO"?"em-aberto":"fechado"}`,s.textContent=t,a.appendChild(r),a.appendChild(s);const c=document.createElement("div");if(c.className="anuncio-info",c.innerHTML=`
    <strong>Autor:</strong> ${e.autora}<br>
    <strong>Editora:</strong> ${e.editora}<br>
    <strong>P√°ginas:</strong> ${e.paginas}
  `,n.appendChild(a),e.imagens&&e.imagens.length>0){const o=document.createElement("img");o.src=e.imagens[0],o.alt=e.titulo,o.className="anuncio-imagem",n.appendChild(o)}n.appendChild(c);const i=document.createElement("div");if(i.className="anuncio-actions",t==="EM ABERTO"){const o=document.createElement("button");o.className="btn-fechar-anuncio",o.textContent="Fechar An√∫ncio",o.addEventListener("click",async()=>{confirm("Deseja realmente fechar este an√∫ncio? Ele n√£o aparecer√° mais na p√°gina inicial.")&&await g(e.id,t)&&f()}),i.appendChild(o)}else{const o=document.createElement("button");o.className="btn-reabrir-anuncio",o.textContent="Reabrir An√∫ncio",o.addEventListener("click",async()=>{await g(e.id,t)&&f()}),i.appendChild(o)}return n.appendChild(i),n}async function f(){const e=await C(),n=document.getElementById("anuncios-list");if(n){if(n.innerHTML="",e.length===0){const t=document.createElement("p");t.textContent="Voc√™ ainda n√£o tem an√∫ncios cadastrados.",t.style.textAlign="center",t.style.color="#6b7280",n.appendChild(t);return}e.forEach(t=>{n.appendChild(v(t))})}}async function _(){try{const{data:{user:e}}=await u.auth.getUser();if(!e)return console.error("Usu√°rio n√£o autenticado"),[];const{data:n,error:t}=await u.from("propostas").select(`
        id,
        anuncio_id,
        interessado_id,
        anunciante_id,
        mensagem,
        valor_oferecido,
        imagens,
        status,
        created_at,
        anuncios:anuncio_id (titulo),
        profiles:interessado_id (username, name, phone)
      `).eq("anunciante_id",e.id).order("created_at",{ascending:!1});return t?(console.error("Erro ao buscar propostas:",t),[]):(n||[]).map(a=>({id:a.id,anuncio_id:a.anuncio_id,interessado_id:a.interessado_id,anunciante_id:a.anunciante_id,mensagem:a.mensagem,valor_oferecido:a.valor_oferecido,imagens:a.imagens,status:a.status,created_at:a.created_at,anuncio_titulo:a.anuncios?.titulo||"An√∫ncio n√£o encontrado",interessado_username:a.profiles?.username||a.profiles?.name||"Usu√°rio desconhecido",interessado_phone:a.profiles?.phone||null}))}catch(e){return console.error("Erro inesperado ao buscar propostas:",e),[]}}function b(e){const n=document.createElement("div");n.className=`proposta-card ${e.status}`;const t=document.createElement("div");t.className="proposta-header";const a=document.createElement("div");a.className="proposta-titulo",a.textContent=e.anuncio_titulo||"Sem t√≠tulo";const r=document.createElement("span");r.className=`proposta-status ${e.status}`,r.textContent=e.status,t.appendChild(a),t.appendChild(r);const s=document.createElement("div");s.className="proposta-info",s.textContent=`De: ${e.interessado_username}`;const c=document.createElement("div");return c.className="proposta-valor",c.textContent=e.valor_oferecido?`R$ ${e.valor_oferecido.toFixed(2)}`:"Sem valor definido",n.appendChild(t),n.appendChild(s),n.appendChild(c),n.addEventListener("click",()=>y(e)),n}function y(e){const n=document.getElementById("proposta-modal"),t=document.getElementById("modal-body");if(!n||!t)return;t.innerHTML="";const a=document.createElement("div");a.className="modal-proposta-info",a.innerHTML=`<strong>An√∫ncio:</strong> ${e.anuncio_titulo}`,t.appendChild(a);const r=document.createElement("div");if(r.className="modal-proposta-info",r.innerHTML=`<strong>Interessado:</strong> ${e.interessado_username}`,t.appendChild(r),e.status==="aceita"&&e.interessado_phone){const o=document.createElement("div");o.className="modal-proposta-info contact-info",o.innerHTML=`<strong>üì± Telefone para contato:</strong> <a href="tel:${e.interessado_phone}">${e.interessado_phone}</a>`,t.appendChild(o)}const s=document.createElement("div");s.className="modal-proposta-info",s.innerHTML=`<strong>Valor Oferecido:</strong> ${e.valor_oferecido?`R$ ${e.valor_oferecido.toFixed(2)}`:"N√£o informado"}`,t.appendChild(s);const c=document.createElement("div");c.className="modal-proposta-info",c.innerHTML=`<strong>Mensagem:</strong><br>${e.mensagem||"Sem mensagem"}`,t.appendChild(c);const i=document.createElement("div");if(i.className="modal-proposta-info",i.innerHTML=`<strong>Status:</strong> <span class="proposta-status ${e.status}">${e.status}</span>`,t.appendChild(i),e.imagens&&e.imagens.length>0){const o=document.createElement("div");o.className="modal-images",e.imagens.forEach(d=>{const l=document.createElement("img");l.src=d,l.alt="Imagem da proposta",o.appendChild(l)}),t.appendChild(o)}if(e.status==="pendente"){const o=document.createElement("div");o.className="modal-actions";const d=document.createElement("button");d.className="btn-aceitar",d.textContent="Aceitar",d.addEventListener("click",async()=>{await h(e.id,"aceita"),p(),E()});const l=document.createElement("button");l.className="btn-recusar",l.textContent="Recusar",l.addEventListener("click",async()=>{await h(e.id,"recusada"),p(),E()}),o.appendChild(d),o.appendChild(l),t.appendChild(o)}n.classList.add("show")}function p(){const e=document.getElementById("proposta-modal");e&&e.classList.remove("show")}async function h(e,n){try{const{data:t,error:a}=await u.from("propostas").select("anuncio_id").eq("id",e).single();if(a){console.error("Erro ao buscar proposta:",a),m("Erro ao buscar proposta. Tente novamente.",3e3,0);return}const{error:r}=await u.from("propostas").update({status:n}).eq("id",e);if(r){console.error("Erro ao atualizar status:",r),m("Erro ao atualizar proposta. Tente novamente.",3e3,0);return}if(n==="aceita"&&t?.anuncio_id){const{error:s}=await u.from("anuncios").update({status:"FECHADO"}).eq("id",t.anuncio_id);s&&console.error("Erro ao fechar an√∫ncio:",s)}m(`Proposta ${n} com sucesso!${n==="aceita"?" O an√∫ncio foi fechado automaticamente.":""}`,3e3,2)}catch(t){console.error("Erro inesperado:",t),m("Erro inesperado. Tente novamente.",3e3,0)}}async function E(){const e=await _(),n=document.getElementById("propostas-list");if(n){if(n.innerHTML="",e.length===0){const t=document.createElement("p");t.textContent="Nenhuma proposta recebida.",t.style.textAlign="center",t.style.color="#6b7280",n.appendChild(t);return}e.forEach(t=>{n.appendChild(b(t))})}}document.addEventListener("DOMContentLoaded",()=>{f(),E();const e=document.querySelector(".close-modal");e&&e.addEventListener("click",p);const n=document.getElementById("proposta-modal");n&&n.addEventListener("click",t=>{t.target===n&&p()})});
